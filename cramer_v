# -*- coding: utf-8 -*-
"""83aa07e8-87ff-4996-abc6-f8f4e302b7eb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/embedded/projects/mystery-box-464018/locations/europe-west3/repositories/83aa07e8-87ff-4996-abc6-f8f4e302b7eb
"""

# @title Setup
from google.cloud import bigquery
from google.colab import data_table
import bigframes.pandas as bpd

project = 'mystery-box-464018' # Project ID inserted based on the query results selected to explore
location = 'US' # Location inserted based on the query results selected to explore
client = bigquery.Client(project=project, location=location)
data_table.enable_dataframe_formatter()

# Running this code will read results from your previous job

job = client.get_job('YOUR_JOB_ID') # Job ID inserted based on the query results selected to explore
destination = job.destination

# Load data from a BigQuery table using BigFrames DataFrames:
bq_df = bpd.read_gbq(f"{destination.project}.{destination.dataset_id}.{destination.table_id}")

import scipy.stats as stats
import pandas as pd
contingency_table = pd.crosstab(bq_df['device_category'], bq_df['traffic_source_medium'])
contingency_table



import numpy as np
X2, p, dof, expected = stats.chi2_contingency(contingency_table)
N = contingency_table.values.sum()
minimum_dimension = min(contingency_table.shape)-1

# Calculate Cramer's V
result = np.sqrt((X2/N) / minimum_dimension)

print("X2: {}".format(X2))
print("p-value: {}".format(p))
print("Cramer V: {}".format(result))



